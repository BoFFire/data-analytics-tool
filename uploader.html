<html>	
    <head>
        <meta charset="UTF-8">
        <!--JQuery-->
        <script src="https://code.jquery.com/jquery-latest.js"></script>
        <!---Ajax-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.js"></script>
        <!--Bootstrap-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"   rel="stylesheet">
        <!--Local styles-->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <link href="/css/footer.css" rel="stylesheet" />
    <link href="/css/index.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
        
        <script type="text/javascript">
            document.write("<base href='" + window.location.origin + "' />");
        </script>

        <meta name="viewport" content="width=device-width, initial-scale=1">
                
        <title>HPLTAnalytics Tool - Uploader</title>
    </head>
    <body>
        <div class="container-fluid main-container">
            <nav class="navbar">
                <a class="navbar-brand" href="/">
                    <img src="img/HPLTAnalytics-light.svg" height="50px" width="240px"/> 
                </a>    
                <div class="nav-links">
                <a href="#" class="single-nav-link">Uploader</a>
                <a href="/viewer/name" class="single-nav-link">Viewer</a>   
            </div>         
            </nav>
            <div class="row my-3">
                <div class="col">                   
                    <h2>Corpus Upload</h2>        
                </div>
            </div>
        

            <form method="POST" action="/upload"  id="upload-form" enctype="multipart/form-data">
                <div class="form-group">
                    <div class="input-group">
                  
                    <div class="name-cont">
                            <label class="form-label" for="corpusname">Name</label>
                            <input class="form-control" id="corpusname" type="text" name="corpusname" required></input>
                    </div>
                    <div class="file-cont">
                        <label class="form-label" for="file">File</label>
                        <input class="form-control file-input" id="corpus" name="corpus" type="file" required />
                </div>
                </div>
                    <div class="inputs">
                        <div class="form-check-inline">
                            <label class="form-label" for="corpus-format">Corpus format</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="corpus-format" id="corpus-format-tsv" value="tsv" checked>
                            <label class="form-check-label" for="corpus-format-tsv">TSV</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="corpus-format" id="corpus-format-tmx" value="tmx">
                            <label class="form-check-label" for="corpus-format-tmx">TMX</label>
                        </div>        
                    </div>



                    <div class="inputs">
                        <div class="form-check-inline">
                            <label class="form-label" for="lang-format">Language</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="lang-format" id="lang-format-mono" value="mono">
                            <label class="form-check-label" for="lang-format-mono">Mono</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="lang-format" id="lang-format-parallel" value="parallel" checked>
                            <label class="form-check-label" for="lang-format-parallel">Parallel</label>
                        </div> 
                    </div>
                    <div class="lang-inputs">
                        <div class="dropdown-cont">
                            <label class="form-label" for="srclang">Source language</label>
                            <select name="srclang" id="srclang"  class="form-select" required></select>
                        </div>
                        <div class="dropdown-cont">
                            <label class="form-label" for="trglang">Target language</label>
                            <select name="trglang" id="trglang"  class="form-select"></select>
                        </div>

                        </div>
                    </div>
                    <!--
                    <div class="row my-3">
                        <h3>Optional</h3>                        
                    </div>
                    <p>
                    Blablabla
                    </p>
                    -->
                            <!--<p>
                                <label for="corpusformat">Corpus format</label>  <input type="radio" id="corpusformat" name="corpusformat" value="TSV">TSV</input>
                            </p>-->                            
                    <div class="uploader-buttons">                                   
                            <button class="button-26" type="submit" form="upload-form">Upload</button>
                            <button id="getcmd-button" class="button-27" type="button" form="upload-form">Get cmd</button>
                            <a  class="button-28" href="/viewer/name">Go to viewer</a>
                    </div>
                    
                </div>
            </form>
            <!-- UPLOAD SUCCESS TOAST -->
            <div class="toast-container position-fixed top-0 end-0 p-3">
                <div id="uploadToast" class="toast"  data-bs-autohide="false" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <strong><i class="bi bi-hand-thumbs-up"></i></strong>
                        <strong class="me-auto"> Corpus uploaded</strong>
        
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        Corpus uploaded. Processing might take some time.
                    </div>
                </div>
            </div>
            <!-- GET CMD MODAL -->
            <div class="modal fade" id="cmd-modal" tabindex="-1" aria-labelledby="cmd-modal-label" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="cmd-modal-label">Command</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <!--<div class="mb-3">
                              <p>
                                  Command:
                              </p>
                          </div>-->
                          <div class="mb-3">
                              <textarea class="form-control" id="command-text" readonly></textarea>
                          </div>
                      </div>
                      <div class="modal-footer">                      
                        <button type="button" class="btn btn-primary" id="command-copy">Copy</button>                      
                        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>

                      </div>
                    </div>
                </div>
          </div>

        </div>
        
        <script>
            const languageNames = new Intl.DisplayNames(['en'], {
                type: 'language'
            }); 

            $(document).ready(function(){
                var cur_url = new URL(window.location.href)
                
                if (cur_url.searchParams.get("fromupload") == "yes") {
                    //show toast
                    const toastUpload = document.getElementById('uploadToast')
                    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastUpload)
                     toastBootstrap.show()    
                     
                     setTimeout(() => {
                        toastBootstrap.hide()
                     }, 4000);
                }


                var srclang_select = $("#srclang")
                var trglang_select = $("#trglang")


                $.ajax({
                    url: "/opus_langs", 
                    success: function(data) {
                        var htmlOptions = [];
                        if (data.length){                          
                            data = JSON.parse(data)
                            //console.log(data)
                            //console.log(data["languages"])
                            for (item in data["languages"]) {
                                //langs = JSON.parse(item)
                                langcode=data["languages"][item]                                
                                if (isNaN(langcode) && langcode.length == 2) {
                                    try {
                                        langname = languageNames.of(langcode)
                                    } catch (err) {
                                        langname = langcode
                                    }
                                    html = '<option value="' + langcode + '">' + langname + " (" + langcode + ")"+ '</option>';
                                    htmlOptions[htmlOptions.length] = html;
                                }
                          } 

                        // here you will empty the pre-existing data from you selectbox and will append the htmlOption created in the loop result
                        srclang_select.empty().append( htmlOptions.join(''))
                        trglang_select.empty().append(htmlOptions.join(''))
                        }
                    },
                    error: function(error) {
                        console.log("ERROR")                    
                        console.log(error)
                        //alert(error);
                    }
                });
            });  
        
        
            $("input[type='radio'][name='lang-format']").change(function() {
                //Disable target lang when mono is selected
                if ( $("input[type='radio'][name='lang-format']:checked").val() == "mono") {
                    $("#trglang").val("");
                    $("#trglang").prop("disabled", true);
                }
                else {
                     $("#trglang").prop("disabled", false);
                }
            });
            
            $("#getcmd-button").click(function(e) {
                if (document.forms["upload-form"].reportValidity()){
                    var formdata = $("#upload-form")
                    $.ajax( {
                        type:"POST",                
                        url:"/getcmd",
                        data:formdata.serialize(),
                        success:
                            function(command){                            
                                cmdModal = document.getElementById('cmd-modal')
                                if (cmdModal) {
                                    // Update the modal's content.
                                    $('#command-text').html(JSON.parse(command))
                                    $('#cmd-modal').modal("show")
                                }
                            },
                        error:
                            function(err) {
                                console.log(err)
                            }                     
                    })
                }
            });
           
            
            $("#command-copy").click(function(e) {
                  var copyText = document.getElementById("command-text");

                  // Select the text field
                  copyText.select();
                  copyText.setSelectionRange(0, 99999); // For mobile devices
                  
                  // Copy the text inside the text field
                  navigator.clipboard.writeText(copyText.value);
                  document.getSelection().removeAllRanges();
                  $("#command-text").trigger("blur")

            });

        </script>
         <div class="footer">
            <div class="footer-text-left">
              <p class="hplt-copyright">Ⓒ HPLT 2023</p>
              <a
                href="https://cordis.europa.eu/project/id/101070350"
                class="horizon-link"
                target="_blank"
              >
                <img
                  src="img/horizon.svg"
                  alt="european-union-flag"
                  class="horizon-logo"
                />
              </a>
      
              <a href="https://www.ukri.org" class="ukri-link" target="_blank">
                <img src="/img/UKRIlogo.png" alt="ukri-logo" class="ukri-logo" />
              </a>
      
              <p class="footer-info">
                This project has received funding from the European Union’s Horizon
                Europe research and innovation programme under grant agreement No
                101070350 and from UK Research and Innovation (UKRI) under the UK
                government’s Horizon Europe funding guarantee [grant number 10052546]
              </p>
            </div>
            <div class="footer-text-middle">
              <img src="/img/eu-flag.png" alt="" class="eu-flag" />
              <p class="footer-info">
                The contents of this publication are the sole responsibility of the
                HPLT consortium and do not necessarily reflect the opinion of the
                European Union.
              </p>
            </div>
            <div class="footer-text-right">
              <a href="https://twitter.com/hplt_eu" target="_blank" rel="noreferrer">
                <img
                  src="/img/logo-black.png"
                  alt="twitter-icon"
                  class="twitter-icon-footer"
                />
              </a>
            </div>
          </div>
    </body>
</html>

